(nb:gotchas)=
## Jupyter notebook gotchas

In computer slang, a "gotcha" often refers to a situation where you may be caught out by expecting a system to behave in one way when it actually behaves in another. There are several "gotchas" that may catch out the unwary when using Jupyter notebooks.

1. Typically, code cells are intended to be executed in linear order from the top to the bottom of the notebook. However, code cells can be selectively executed in any order. Take care not to execute cells out of order. If your code is not executing as expected, and you think it may be because of out of order code execution, restart the notebook kernel and execute the cells again in the correct order, from the top down, up to the cell you are working on. Alternatively, from the `Kernel` menu, select `Restart Kernel and Run up to Selected Cell...`.

2. A displayed cell output may not reflect the current state of the code environment. If a cell is used to display the output of a variable, if the value of the variable is changed by code executing later in the notebook, the previously displayed is not updated. The output is the value of the variable at the time the cell generated the output.

3. When you open a *new* notebook, the notebook server starts a new Jupyter kernel. However, opening a previously opened notebook does not necessarily create a new notebook kernel. If the notebook tab was closed without stopping the kernel, the previous kernel may still be running when the notebook is reopened. You can restart a kernel at any point to ensure you are working with a fresh kernel. The kernel will be restarted in a state where none of the code cells have run.

4. When running a local VCE, if you hibernate your computer and then wake it up again, any running Jupyter kernel processes should hibernate and still retain their previous state. If you stop a notebook, either from the notebooks folder home page or by stopping and restarting the VCE, then the Jupyter kernel process will be stopped and all state (as far as the process is concerned) will be lost.

5. Do not open the same notebook in more than one browser or more than one browser tab at the same time. All instances of the notebook will access the same kernel, and may affect its state when a code cell is run. However, updates made to the notebook text in one tab will *not* be reflected in that same notebook view in the other tab(s). If one copy of the duplicate opened notebooks is saved, the duplicate copies in other tabs will pop up an alert warning of differences between the current and saved notebooks. Avoid this problem by only opening a notebook in a single tab.

6. Values of cell outputs do not necessarily reflect the current state of variables contained in the corresponding code cell. If you open a notebook with a new kernel, the values of any previously run cell outputs are a record of what happened when they were last run in the previous kernel. Clear all the cell outputs to prevent any confusion as to whether the cell output was generated in the current notebook session (`Kernel > Restart Kernel and Clear Outputs of All Cells...` menu option).

7. It is possible that you may attempt to close the browser tab for a  notebook without the content changes having been saved. The browser will usually display a warning and offer you the option of staying on the page, or leaving the page -- this warning will differ depending on your host browser, but will say something like 'Are you sure you want to leave this page?'. This is a sign that the most recent changes to the page haven't been saved -- usually you want to stay on the page, click the save icon, then close the tab.

8. If you accidentally delete a notebook, you may be able to recover the commands you previously ran. The [IPython `%history` magic](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-history) can search back into the cell execution history of previous sessions. To save run commands from all previous IPython sessions to a file, run `%history -g -f ipython_history.txt`. Note that in the hosted VCE, the IPython session history may be limited to the commands you have executed since you last launched the VCE.